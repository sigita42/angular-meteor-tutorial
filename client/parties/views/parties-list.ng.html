<!--{{}} is a binding projecting application model, which is set up in the controller-->
<div>
	<form ng-show="$root.currentUser">
		<label>Name</label>
		<input ng-model="newParty.name">
		<label>Description</label>
		<input ng-model="newParty.description">
		<label>Public</label>
		<input type="checkbox" ng-model="newParty.public">
		<button ng-click="newParty.owner=$root.currentUser._id; ctrl.parties.push(newParty)">Add</button>
		<button ng-click="ctrl.removeAll()">Remove All</button>
	</form>
	<div ng-hide="$root.currentUser || $root.loggingIn">Log in to create a party!</div>
	
	<h1 ng-repeat="greetname in ctrl.greetnames">Hello, {{greetname.name}}</h1>
	<h1>Parties:</h1>
	<div>
		<input type="search" ng-model="ctrl.search" placeholder="Search">
		<select ng-model="ctrl.orderProperty">
			<option value="1">Ascending</option>
			<option value="-1">Descending</option>
		</select>
	</div>
	<div class="angular-google-map-container">
		<ui-gmap-google-map center="ctrl.map.center" zoom="ctrl.map.zoom">
			<ui-gmap-markers models="ctrl.parties" coords="'location'" click="onClicked()" fit="true" idkey="'_id'" doRebuildAll="true">
			</ui-gmap-markers>
		</ui-gmap-google-map>
	</div>
	<ul>
		<li dir-paginate="party in ctrl.parties | itemsPerPage: ctrl.perPage" total-items="ctrl.partiesCount.count">
<!--		<li dir-paginate="party in ctrl.parties | itemsPerPage: ctrl.perPage" total-items="10">-->
			<a ui-sref="partyDetails({partyId: party._id})">{{party.name}}</a>
			<p>{{party.description}}</p>
			<button ng-click="ctrl.removeParty(party)" ng-show="$root.currentUser && $root.currentUser._id == party.owner">X</button>
			<p><small>Posted by {{ ctrl.creator(party) | displayName }}</small></p>
   			<div ng-show="$root.currentUser">
		      <input type="button" value="I'm going!" ng-click="ctrl.rsvp(party._id, 'yes')">
		      <input type="button" value="Maybe" ng-click="ctrl.rsvp(party._id, 'maybe')">
		      <input type="button" value="No" ng-click="ctrl.rsvp(party._id, 'no')">
		    </div>
			<div ng-hide="$root.currentUser">
				<i>Sign in to RSVP for this party!</i>
			</div>
			<div>
				Who is coming?
				Yes - {{ (party.rsvps | filter:{rsvp: 'yes'}).length }}
				Maybe - {{ (party.rsvps | filter:{rsvp: 'maybe'}).length }}
				No - {{ (party.rsvps | filter:{rsvp: 'no'}).length }}
				<div ng-repeat="rsvp in party.rsvps | filter:{rsvp: 'yes'}">
					{{ ctrl.getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
				</div>
				<div ng-repeat="rsvp in party.rsvps | filter:{rsvp: 'maybe'}">
					{{ ctrl.getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
				</div>
				<div ng-repeat="rsvp in party.rsvps | filter:{rsvp: 'no'}">
					{{ ctrl.getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
				</div>
			</div>
			<ul ng-if="!party.public">
				Users who have not responded:
				<li ng-repeat="invitedUser in ctrl.outstandingInvitations(party)">
					{{ invitedUser | displayName }}
				</li>
			</ul>
			<div ng-if="party.public">Everyone is invited!</div>
		</li>
	</ul>
	<dir-pagination-controls on-page-change="ctrl.pageChanged(newPageNumber)"></dir-pagination-controls>

</div>